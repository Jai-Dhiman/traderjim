name = "mahler"
main = "src/entry.py"
compatibility_date = "2024-12-01"
compatibility_flags = ["python_workers"]

[observability]
enabled = true

# Cron triggers for scheduled workers
# Times are in UTC (ET = UTC-5 during EST, UTC-4 during EDT)
# Research: First 30 min (9:30-10:00 AM) have wider spreads and stale quotes
[triggers]
crons = [
    "0 15 * * MON-FRI",      # morning_scan: 10:00 AM ET (15:00 UTC during EST)
    "0 17 * * MON-FRI",      # midday_check: 12:00 PM ET (17:00 UTC during EST)
    "30 20 * * MON-FRI",     # afternoon_scan: 3:30 PM ET (20:30 UTC during EST)
    "15 21 * * MON-FRI",     # eod_summary: 4:15 PM ET (21:15 UTC during EST)
    "*/5 15-21 * * MON-FRI", # position_monitor: every 5 min (10 AM - 4 PM ET)
]

# D1 SQLite database for persistent storage
[[d1_databases]]
binding = "MAHLER_DB"
database_name = "mahler-db"
database_id = "b6cb2eac-2903-46bd-baea-b4ff2dc904d0"

# KV namespace for fast state (circuit breakers, rate limits)
[[kv_namespaces]]
binding = "MAHLER_KV"
id = "4e63db1305a1424ead3565522a47b5f4"

# R2 bucket for archival storage
# Create with: wrangler r2 bucket create mahler-archive
[[r2_buckets]]
binding = "ARCHIVE"
bucket_name = "mahler-archive"

# Environment variables (non-secret)
[vars]
ENVIRONMENT = "paper"
LOG_LEVEL = "INFO"
AUTO_APPROVE_TRADES = "true"  # Auto-execute trades without manual Discord approval
